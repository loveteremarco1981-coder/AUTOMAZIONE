<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Casa · Dashboard</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>

  <!-- ===== TOP BAR (come nello screenshot) ===== -->
  <header class="topbar">
    <div class="left">
      <div class="home-title">
        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
          <path fill="currentColor" d="M12 3 2 12h3v9h6v-6h2v6h6v-9h3z"/>
        </svg>
        <button class="title-btn" aria-label="Seleziona casa">
          <span id="homeName">Casa</span>
          <svg class="chev" width="16" height="16" viewBox="0 0 24 24">
            <path fill="currentColor" d="M7 10l5 5 5-5z"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="right">
      <!-- tre quick actions (solo estetica) -->
      <button class="icon-btn" title="Messaggi" aria-label="Messaggi">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M4 5h16v12H7l-3 3V5z"/>
        </svg>
      </button>
      <button class="icon-btn" title="Aggiungi" aria-label="Aggiungi">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/>
        </svg>
      </button>
      <button class="icon-btn" title="Altro" aria-label="Altro">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M12 7a2 2 0 110-4 2 2 0 010 4zm0 7a2 2 0 110-4 2 2 0 010 4zm0 7a2 2 0 110-4 2 2 0 010 4z"/>
        </svg>
      </button>
    </div>
  </header>

  <main>
    <!-- ===== VIEW: HOME ===== -->
    <section id="view-home" class="view active">
      <div class="row-head">
        <h3 class="section-label">Dashboard</h3>
        <!-- chip meteo a destra -->
        <div id="weatherChip" class="weather-chip" title="Meteo">
          <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
            <path fill="currentColor" d="M12 4a4 4 0 0 1 4 4h4a6 6 0 1 1-12 0 4 4 0 0 1 4-4z"/>
          </svg>
          <span id="weatherTemp">--°</span>
        </div>
      </div>

      <!-- due card scure orizzontali -->
      <div class="pill-row">
        <article class="pill-card" id="pill-offline">
          <div class="pill-icon">
            <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M3.5 12a5.5 5.5 0 0 1 5.5-5.5H12v2H9a3.5 3.5 0 1 0 0 7h3v2H9A5.5 5.5 0 0 1 3.5 12ZM12 11h4v2h-4zM15 6.5H18A5.5 5.5 0 1 1 18 17h-3v-2h3a3.5 3.5 0 1 0 0-7h-3v-1.5Z"/></svg>
          </div>
          <div class="pill-body">
            <div class="pill-title muted">Offline</div>
            <div class="pill-value"><span id="offlineCount">—</span> dispositivi</div>
          </div>
        </article>

        <article class="pill-card" id="pill-energy">
          <div class="pill-icon energy">
            <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M13 2 3 14h7l-1 8 11-14h-7l1-6z"/></svg>
          </div>
          <div class="pill-body">
            <div class="pill-title muted">Energy</div>
            <div class="pill-value"><span id="energyKwh">—</span> kWh</div>
          </div>
        </article>
      </div>

      <h3 class="section-label">Preferiti</h3>
      <section id="favoritesGrid" class="favorites-grid"><!-- tiles generate via JS --></section>

      <div class="provider-row">
        <div class="provider" id="weatherProvider">The Weather Channel</div>
        <div class="updated muted" id="ts">Aggiornamento: —:—</div>
      </div>
    </section>

    <!-- ===== VIEW: DISPOSITIVI ===== -->
    <section id="view-devices" class="view">
      <h3 class="section-label">Dispositivi</h3>
      <div id="devicesList" class="list"></div>
      <div id="devicesEmpty" class="muted"></div>
    </section>

    <!-- ===== VIEW: LIFE (placeholder) ===== -->
    <section id="view-life" class="view">
      <h3 class="section-label">Life</h3>
      <div class="muted" style="margin:8px 6px">Collega qui automazioni/presenze se necessario.</div>
    </section>

    <!-- ===== VIEW: ROUTINE ===== -->
    <section id="view-routine" class="view">
      <h3 class="section-label">Routine</h3>
      <div id="flowsList" class="list"></div>
      <div id="flowsEmpty" class="muted"></div>
    </section>

    <!-- ===== VIEW: MENU ===== -->
    <section id="view-menu" class="view">
      <h3 class="section-label">Menu</h3>
      <div class="menu-grid">
        <button class="menu-btn" data-target="home">Home</button>
        <button class="menu-btn" data-target="devices">Dispositivi</button>
        <button class="menu-btn" data-target="routine">Routine</button>
        <button class="menu-btn" data-target="life">Life</button>
        <a class="menu-btn" href="#" id="openLog">Log errori</a>
      </div>
      <!-- Log in overlay modale per non “sporcare” la Home -->
      <dialog id="logModal" class="modal">
        <div class="modal-head">
          <h3>Log errori automazioni</h3>
          <button id="btnRefreshLog" class="pill-btn" style="margin-left:auto">
            <svg width="18" height="18" viewBox="0 0 24 24"><path d="M21 12a9 9 0 1 1-3.5-7.1" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/><path d="M21 4v6h-6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Aggiorna
          </button>
          <button id="closeLog" class="icon-btn" title="Chiudi" aria-label="Chiudi">
            <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M18 6 6 18M6 6l12 12"/></svg>
          </button>
        </div>
        <div id="log" class="list"></div>
        <div id="logEmpty" class="muted"></div>
      </dialog>
    </section>
  </main>

  <!-- ===== TAB BAR (identica allo screenshot) ===== -->
  <footer class="tabbar">
    <button class="tab active" data-target="home" title="Home">
      <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M12 3 3 10v11h6v-6h6v6h6V10z"/></svg>
      <span>Home</span>
    </button>
    <button class="tab" data-target="devices" title="Dispositivi">
      <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M3 5h18v6H3V5zm0 8h8v6H3v-6zm10 0h8v6h-8v-6z"/></svg>
      <span>Dispositivi</span>
    </button>
    <button class="tab" data-target="life" title="Life" data-dot="false">
      <svg viewBox="0 0 24 24" width="22" height="22"><rect x="4" y="4" width="16" height="16" rx="4" fill="currentColor"/></svg>
      <span>Life</span>
    </button>
    <button class="tab" data-target="routine" title="Routine">
      <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M12 7a5 5 0 1 1-4.9 6h2.1a3 3 0 1 0 0-2H7.1A5 5 0 0 1 12 7zm0-5a1 1 0 0 1 1 1v2h-2V3a1 1 0 0 1 1-1zm0 18a1 1 0 0 1 1 1v2h-2v-2a1 1 0 0 1 1-1z"/></svg>
      <span>Routine</span>
    </button>
    <button class="tab" data-target="menu" title="Menu" data-dot="true">
      <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
      <span>Menu</span>
    </button>
  </footer>

  <!-- SCRIPTS -->
  <script src="config.js"></script>
  <script src="jsonp.js"></script>
  <script src="app.js"></script>
</body>
</html>
``
